{
  "info": {
    "name": "FitnessReservation API v1",
    "_postman_id": "0d5c17a1-3c1b-4b2b-8d7d-b0c14e3f6f3a",
    "description": "Black-box API smoke tests (auth + sessions + reservations).",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "pm.expect(pm.environment.get('baseUrl')).to.not.be.empty;",
          "// random usernames per run",
          "const rand = Math.floor(Math.random()*1e9).toString();",
          "pm.environment.set('u1', 'u1_' + rand);",
          "pm.environment.set('u2', 'u2_' + rand);"
        ]
      }
    }
  ],
  "item": [
    {
      "name": "__TEST__ Reset - POST /__test/reset",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "url": {
          "raw": "{{baseUrl}}/__test/reset",
          "host": [ "{{baseUrl}}" ],
          "path": [ "__test", "reset" ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 200', function () { pm.response.to.have.status(200); });"
            ]
          }
        }
      ]
    },
    {
      "name": "Health - GET /health",
      "request": {
        "method": "GET",
        "url": {
          "raw": "{{baseUrl}}/health",
          "host": [ "{{baseUrl}}" ],
          "path": [ "health" ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 200', function () { pm.response.to.have.status(200); });",
              "pm.test('Body has status=ok', function () { const b = pm.response.json(); pm.expect(b.status).to.eql('ok'); });"
            ]
          }
        }
      ]
    },

    {
      "name": "Auth - Register user1 - POST /auth/register",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"username\": \"{{u1}}\",\n  \"password\": \"{{p1}}\",\n  \"membershipType\": \"Standard\",\n  \"membershipCode\": null\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/auth/register",
          "host": [ "{{baseUrl}}" ],
          "path": [ "auth", "register" ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 201', function () { pm.response.to.have.status(201); });"
            ]
          }
        }
      ]
    },
    {
      "name": "Auth - Login user1 - POST /auth/login",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"username\": \"{{u1}}\",\n  \"password\": \"{{p1}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/auth/login",
          "host": [ "{{baseUrl}}" ],
          "path": [ "auth", "login" ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 200', function () { pm.response.to.have.status(200); });"
            ]
          }
        }
      ]
    },
    {
      "name": "Auth - Me - GET /me",
      "request": {
        "method": "GET",
        "url": {
          "raw": "{{baseUrl}}/me",
          "host": [ "{{baseUrl}}" ],
          "path": [ "me" ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 200', function () { pm.response.to.have.status(200); });",
              "pm.test('Has membershipType', function () { const b = pm.response.json(); pm.expect(b.membershipType).to.be.oneOf(['Standard','Student','Premium']); });"
            ]
          }
        }
      ]
    },

    {
      "name": "Sessions - GET /sessions (Yoga window)",
      "request": {
        "method": "GET",
        "url": {
          "raw": "{{baseUrl}}/sessions?sport=Yoga&from=2000-01-01T00:00:00Z&to=2100-01-01T00:00:00Z",
          "host": [ "{{baseUrl}}" ],
          "path": [ "sessions" ],
          "query": [
            {
              "key": "sport",
              "value": "Yoga"
            },
            {
              "key": "from",
              "value": "2000-01-01T00:00:00Z"
            },
            {
              "key": "to",
              "value": "2100-01-01T00:00:00Z"
            }
          ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 200', function () { pm.response.to.have.status(200); });",
              "pm.test('Body is array', function () { const b = pm.response.json(); pm.expect(b).to.be.an('array'); pm.expect(b.length).to.be.greaterThan(0); });",
              "pm.test('Each item has price.finalPrice > 0', function () { const b = pm.response.json(); b.forEach(x => { pm.expect(x.price.finalPrice).to.be.greaterThan(0); }); });"
            ]
          }
        }
      ]
    },

    {
      "name": "Reservations - POST /reservations (success -> 201)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"sessionId\": \"{{futureGeneralSessionId}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/reservations",
          "host": [ "{{baseUrl}}" ],
          "path": [ "reservations" ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 201', function () { pm.response.to.have.status(201); });",
              "pm.test('Body has reservationId + finalPrice', function () { const b = pm.response.json(); pm.expect(b.reservationId).to.be.a('string'); pm.expect(b.finalPrice).to.be.greaterThan(0); });"
            ]
          }
        }
      ]
    },

    {
      "name": "Reservations - POST /reservations (duplicate -> 409)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"sessionId\": \"{{futureGeneralSessionId}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/reservations",
          "host": [ "{{baseUrl}}" ],
          "path": [ "reservations" ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 409', function () { pm.response.to.have.status(409); });"
            ]
          }
        }
      ]
    },

    {
      "name": "Reservations - POST /reservations (past -> 400)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"sessionId\": \"{{pastSessionId}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/reservations",
          "host": [ "{{baseUrl}}" ],
          "path": [ "reservations" ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 400', function () { pm.response.to.have.status(400); });"
            ]
          }
        }
      ]
    },

    {
      "name": "Reservations - POST /reservations (session not found -> 404)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"sessionId\": \"00000000-0000-0000-0000-000000000000\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/reservations",
          "host": [ "{{baseUrl}}" ],
          "path": [ "reservations" ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 404', function () { pm.response.to.have.status(404); });"
            ]
          }
        }
      ]
    },

    {
      "name": "Reservations - POST /reservations (capacity=1 user1 -> 201)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"sessionId\": \"{{futureCapacity1SessionId}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/reservations",
          "host": [ "{{baseUrl}}" ],
          "path": [ "reservations" ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 201', function () { pm.response.to.have.status(201); });"
            ]
          }
        }
      ]
    },

    {
      "name": "Auth - Logout user1 - POST /auth/logout",
      "request": {
        "method": "POST",
        "url": {
          "raw": "{{baseUrl}}/auth/logout",
          "host": [ "{{baseUrl}}" ],
          "path": [ "auth", "logout" ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 200', function () { pm.response.to.have.status(200); });"
            ]
          }
        }
      ]
    },

    {
      "name": "Auth - Register user2 - POST /auth/register",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"username\": \"{{u2}}\",\n  \"password\": \"{{p2}}\",\n  \"membershipType\": \"Standard\",\n  \"membershipCode\": null\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/auth/register",
          "host": [ "{{baseUrl}}" ],
          "path": [ "auth", "register" ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 201', function () { pm.response.to.have.status(201); });"
            ]
          }
        }
      ]
    },
    {
      "name": "Auth - Login user2 - POST /auth/login",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"username\": \"{{u2}}\",\n  \"password\": \"{{p2}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/auth/login",
          "host": [ "{{baseUrl}}" ],
          "path": [ "auth", "login" ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 200', function () { pm.response.to.have.status(200); });"
            ]
          }
        }
      ]
    },

    {
      "name": "Reservations - POST /reservations (capacity full user2 -> 409)",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"sessionId\": \"{{futureCapacity1SessionId}}\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/reservations",
          "host": [ "{{baseUrl}}" ],
          "path": [ "reservations" ]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Status is 409', function () { pm.response.to.have.status(409); });"
            ]
          }
        }
      ]
    }
  ]
}
